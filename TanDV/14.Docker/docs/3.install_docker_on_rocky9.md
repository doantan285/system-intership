# Cài đặt Docker trên Rocky Linux 9

## I. Yêu cầu tiên quyết

- Máy 64-bit, kết nối Internet.
- Có quyền `sudo` trên máy Rocky Linux 9.
- Lưu ý: Rocky9 dùng cgroups v2 và mặc định bật SELinux=Enforcing — mình sẽ nêu cách xử lý các vấn đề liên quan.

## II. Cài đặt docker

### 1. Gỡ các package Docker cũ (nếu có)

```bash
sudo dnf remove -y docker \
  docker-client \
  docker-client-latest \
  docker-common \
  docker-latest \
  docker-latest-logrotate \
  docker-logrotate \
  docker-engine
```

- Tránh xung đột với các gói Docker/old packages.

### 2. Cài plugin quản lý repo và thêm repository chính thức của Docker

```bash
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

- Docker duy trì repo cho RHEL/CentOS; Rocky (RHEL-compatible) có thể dùng repo này để nhận Docker CE mới nhất.

### 3. Cài Docker Engine và runtime

```bash
sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

- `docker-ce`: Docker Engine (daemon).
- `containerd.io`: runtime quản lý container lifecycle.
- `docker-ce-cli`: client (lệnh `docker`).
- `docker-buildx-plugin`, `docker-compose-plugin`: plugin tiện ích.

### 4. Bật và khởi động dịch vụ Docker (và containerd)

```bash
sudo systemctl enable --now containerd
sudo systemctl enable --now docker
```

Kiểm tra trạng thái:

```bash
sudo systemctl status docker --no-pager
sudo systemctl status containerd --no-pager
```

- `dockerd` (Docker daemon) thường dùng `containerd` làm runtime; cần bật cả hai.
- Trạng thái `active (running)` nghĩa là dịch vụ đang chạy tốt.

### 5. Kiểm tra cài đặt Docker

```bash
sudo docker version
sudo docker info
sudo docker run --rm hello-world
```

- Nếu thấy thông báo “Hello from Docker!”, Docker đã chạy chính xác.
